by= 'year') %>%
select(year,sector, PT_arg_base = PT_arg, TCC, TCP_1),
by = c('year', 'sector') ) %>%
mutate(brecha_anio_base = (PT_arg_base*TCC/TCP_1)/PT_bench_base )
df_manuf_brecha <- df_manuf_arg %>%
select(-country) %>%
right_join(df_manuf_eu,
by=c('year', 'sector')) %>%
left_join(df_manuf_benchmark %>%
select(year, country, sector, brecha_anio_base ),
by=c('year', 'country', 'sector'))
#SAVE
write.table(df_manuf_brecha,
'./results/bea/majority_owned_nonbank/brecha_productividad_all_sectors.csv',
row.names = F
# , dec = ','
#  ,sep = ';'
)
glimpse(data_prod_0)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
# group_by(country, sector) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
ungroup()
)
last_dplyr_warnings()
glimpse(data_prod_0)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
group_by(country, sector, Continent, CODE) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
ungroup()
)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
group_by(country, Continent, CODE) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
ungroup()
)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
group_by(country, Continent, CODE) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
ungroup()
)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
# group_by(country, Continent, CODE) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
# ungroup()
)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
# group_by(country, Continent, CODE) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) #%>%
# ungroup()
)
View(data_prod)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
# group_by(country, Continent, CODE) %>%
group_by(year) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) #%>%
# ungroup()
)
data_prod <- data_prod_0 %>%
bind_rows(
data_prod_0 %>%
filter(sector == "Total Manufacturing") %>% #, country == "Argentina"
# group_by(country, Continent, CODE) %>%
group_by(year) %>%
mutate(
sector = "Manufacturing without Transportation Equipment",
employment = employment - data_prod_0$employment[data_prod_0$sector == "Transportation Equipment"],
value_added = value_added - data_prod_0$value_added[data_prod_0$sector == "Transportation Equipment"],
PT = value_added/employment
) %>%
ungroup()
)
data_prod_0
View(df)
library(pwt10)
data <- pwt10.01
glimpse(data)
library(pwt10)
library(tidyverse)
data <- pwt10.01
glimpse(data)
library(tidyverse)
get_index <- function(df, name_var, production, work, base_year, index_bool = TRUE, countries = NULL, method = 1, plot_bool = FALSE, notes = NULL) {
if (work == 'emp') {
df[[name_var]] <- df[[production]] / df[[work]]
} else if (work == 'avh') {
df[[name_var]] <- df[[production]] / (df[[work]] * df[['emp']])
}
if (index_bool) {
name_index <- paste0(name_var, '_index')
base_year <- base_year
# calculate the base productivity for each country
if (method == 1) {
base_prod <- df %>%
filter(year == base_year) %>%
group_by(country) %>%
summarise(prod_base = first(!!sym(name_var)))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := (!!sym(name_var) / prod_base) * 100) %>%
select(-prod_base)
} else {
base_prod <- df %>%
filter(year == base_year) %>%
select(country, prod_base = !!sym(name_var))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := !!sym(name_var) / prod_base * 100) %>%
select(-prod_base)
}
}
if (plot_bool) {
sel_countries <- if (!is.null(countries)) countries else unique(df$country)
if (method == 1) {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index)) %>%
spread(country, !!sym(name_index))
} else {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index))
}
# create a line plot of the index values for each country
pivot %>%
ggplot(aes(x = year)) +
geom_line(aes(y = !!sym(name_index), color = country)) +
labs(title = paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100'),
x = 'Year',
y = 'Index') +
theme_minimal() +
theme(legend.position = 'top') +
annotate('text', x = 0.1, y = -0.20, label = notes, hjust = 0, vjust = 0)
# save the plot
ggsave(paste0(gsub('[/\\.]', '', paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100')), '.png'),
plot = last_plot(), dpi = 300, bbox_inches = 'tight')
}
return(NULL)
}
# Example usage
sel_countries <- c('Argentina', 'United States', 'Germany', 'Brazil', 'Republic of Korea')
base_year <- 2015
name_var <- 'productivity_emp'
production <- 'rgdpna'
work <- 'emp'
notes <- NULL
get_index(data, name_var = name_var, production = production, work = work, base_year = base_year,
countries = sel_countries, method = 2,
plot_bool = TRUE, notes = notes)
library(tidyverse)
get_index <- function(df, name_var, production, work, base_year, index_bool = TRUE, countries = NULL, method = 1, plot_bool = FALSE, notes = NULL) {
if (work == 'emp') {
df[[name_var]] <- df[[production]] / df[[work]]
} else if (work == 'avh') {
df[[name_var]] <- df[[production]] / (df[[work]] * df[['emp']])
}
if (index_bool) {
name_index <- paste0(name_var, '_index')
base_year <- base_year
# calculate the base productivity for each country
if (method == 1) {
base_prod <- df %>%
filter(year == base_year) %>%
group_by(country) %>%
summarise(prod_base = first(!!sym(name_var)))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := (!!sym(name_var) / prod_base) * 100) %>%
select(-prod_base)
} else {
base_prod <- df %>%
filter(year == base_year) %>%
select(country, prod_base = !!sym(name_var))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := !!sym(name_var) / prod_base * 100) %>%
select(-prod_base)
}
}
if (plot_bool) {
sel_countries <- if (!is.null(countries)) countries else unique(df$country)
if (method == 1) {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index)) %>%
spread(country, !!sym(name_index))
} else {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index))
}
# create a line plot of the index values for each country
plot <- pivot %>%
ggplot(aes(x = year)) +
geom_line(aes(y = !!sym(name_index), color = country)) +
labs(title = paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100'),
x = 'Year',
y = 'Index') +
theme_minimal() +
theme(legend.position = 'top') +
annotate('text', x = 0.1, y = -0.20, label = notes, hjust = 0, vjust = 0)
# save the plot
ggsave(paste0(gsub('[/\\.]', '', paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100')), '.png'),
plot = plot, width = 10, height = 6, dpi = 300)
}
return(NULL)
}
# Example usage
sel_countries <- c('Argentina', 'United States', 'Germany', 'Brazil', 'Republic of Korea')
base_year <- 2015
name_var <- 'productivity_emp'
production <- 'rgdpna'
work <- 'emp'
notes <- NULL
get_index(df, name_var = name_var, production = production, work = work, base_year = base_year,
countries = sel_countries, method = 2,
plot_bool = TRUE, notes = notes)
library(tidyverse)
get_index <- function(df, name_var, production, work, base_year, index_bool = TRUE, countries = NULL, method = 1, plot_bool = FALSE, notes = NULL) {
if (work == 'emp') {
df[[name_var]] <- df[[production]] / df[[work]]
} else if (work == 'avh') {
df[[name_var]] <- df[[production]] / (df[[work]] * df[['emp']])
}
if (index_bool) {
name_index <- paste0(name_var, '_index')
base_year <- base_year
# calculate the base productivity for each country
if (method == 1) {
base_prod <- df %>%
filter(year == base_year) %>%
group_by(country) %>%
summarise(prod_base = first(!!sym(name_var)))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := (!!sym(name_var) / prod_base) * 100) %>%
select(-prod_base)
} else {
base_prod <- df %>%
filter(year == base_year) %>%
select(country, prod_base = !!sym(name_var))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := !!sym(name_var) / prod_base * 100) %>%
select(-prod_base)
}
}
if (plot_bool) {
sel_countries <- if (!is.null(countries)) countries else unique(df$country)
if (method == 1) {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index)) %>%
spread(country, !!sym(name_index))
} else {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index))
}
# create a line plot of the index values for each country
plot <- pivot %>%
ggplot(aes(x = year)) +
geom_line(aes(y = !!sym(name_index), color = country)) +
labs(title = paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100'),
x = 'Year',
y = 'Index') +
theme_minimal() +
theme(legend.position = 'top') +
annotate('text', x = 0.1, y = -0.20, label = notes, hjust = 0, vjust = 0)
# save the plot
ggsave(paste0(gsub('[/\\.]', '', paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100')), '.png'),
plot = plot, width = 10, height = 6, dpi = 300)
}
return(NULL)
}
# Example usage
sel_countries <- c('Argentina', 'United States', 'Germany', 'Brazil', 'Republic of Korea')
base_year <- 2015
name_var <- 'productivity_emp'
production <- 'rgdpna'
work <- 'emp'
notes <- NULL
get_index(data, name_var = name_var, production = production, work = work, base_year = base_year,
countries = sel_countries, method = 2,
plot_bool = TRUE, notes = notes)
library(tidyverse)
get_index <- function(df, name_var, production, work, base_year, index_bool = TRUE, countries = NULL, method = 1, plot_bool = FALSE, notes = NULL) {
if (work == 'emp') {
df[[name_var]] <- df[[production]] / df[[work]]
} else if (work == 'avh') {
df[[name_var]] <- df[[production]] / (df[[work]] * df[['emp']])
}
if (index_bool) {
name_index <- paste0(name_var, '_index')
base_year <- base_year
# calculate the base productivity for each country
if (method == 1) {
base_prod <- df %>%
filter(year == base_year) %>%
group_by(country) %>%
summarise(prod_base = first(!!sym(name_var)))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := (!!sym(name_var) / prod_base) * 100) %>%
select(-prod_base)
} else {
base_prod <- df %>%
filter(year == base_year) %>%
select(country, prod_base = !!sym(name_var))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := !!sym(name_var) / prod_base * 100) %>%
select(-prod_base)
}
}
if (plot_bool) {
sel_countries <- if (!is.null(countries)) countries else unique(df$country)
if (method == 1) {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index)) %>%
spread(country, !!sym(name_index))
} else {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index))
}
# create a line plot of the index values for each country
plot <- pivot %>%
ggplot(aes(x = year)) +
geom_line(aes(y = !!sym(name_index), color = country)) +
labs(title = paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100'),
x = 'Year',
y = 'Index') +
theme_minimal() +
theme(legend.position = 'top') +
annotate('text', x = 0.1, y = -0.20, label = notes, hjust = 0, vjust = 0)
plot
# save the plot
ggsave(paste0(gsub('[/\\.]', '', paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100')), '.png'),
plot = plot, width = 10, height = 6, dpi = 300)
}
return(NULL)
}
# Example usage
sel_countries <- c('Argentina', 'United States', 'Germany', 'Brazil', 'Republic of Korea')
base_year <- 2015
name_var <- 'productivity_emp'
production <- 'rgdpna'
work <- 'emp'
notes <- NULL
get_index(data, name_var = name_var, production = production, work = work, base_year = base_year,
countries = sel_countries, method = 2,
plot_bool = TRUE, notes = notes)
library(tidyverse)
get_index <- function(df, name_var, production, work, base_year, index_bool = TRUE, countries = NULL, method = 1, plot_bool = FALSE, notes = NULL) {
if (work == 'emp') {
df[[name_var]] <- df[[production]] / df[[work]]
} else if (work == 'avh') {
df[[name_var]] <- df[[production]] / (df[[work]] * df[['emp']])
}
if (index_bool) {
name_index <- paste0(name_var, '_index')
base_year <- base_year
# calculate the base productivity for each country
if (method == 1) {
base_prod <- df %>%
filter(year == base_year) %>%
group_by(country) %>%
summarise(prod_base = first(!!sym(name_var)))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := (!!sym(name_var) / prod_base) * 100) %>%
select(-prod_base)
} else {
base_prod <- df %>%
filter(year == base_year) %>%
select(country, prod_base = !!sym(name_var))
df <- df %>%
left_join(base_prod, by = 'country') %>%
mutate(!!name_index := !!sym(name_var) / prod_base * 100) %>%
select(-prod_base)
}
}
if (plot_bool) {
sel_countries <- if (!is.null(countries)) countries else unique(df$country)
if (method == 1) {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index)) %>%
spread(country, !!sym(name_index))
} else {
pivot <- df %>%
filter(country %in% sel_countries) %>%
select(year, country, !!sym(name_index))
}
# create a line plot of the index values for each country
plot <- pivot %>%
ggplot(aes(x = year)) +
geom_line(aes(y = !!sym(name_index), color = country)) +
labs(title = paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100'),
x = 'Year',
y = 'Index') +
theme_minimal() +
theme(legend.position = 'top') +
annotate('text', x = 0.1, y = -0.20, label = notes, hjust = 0, vjust = 0)
print(plot)
# save the plot
ggsave(paste0(gsub('[/\\.]', '', paste0('Productivity Index (', production, '/', work, '). ', base_year, '=100')), '.png'),
plot = plot, width = 10, height = 6, dpi = 300)
}
return(NULL)
}
# Example usage
sel_countries <- c('Argentina', 'United States', 'Germany', 'Brazil', 'Republic of Korea')
base_year <- 2015
name_var <- 'productivity_emp'
production <- 'rgdpna'
work <- 'emp'
notes <- NULL
get_index(data, name_var = name_var, production = production, work = work, base_year = base_year,
countries = sel_countries, method = 2,
plot_bool = TRUE, notes = notes)
library(tidyverse)
library(tidyverse)
library(readxl)
df_uy <- rea
library(tidyverse)
library(readxl)
df_uy <- read_excel('data/pict/base_total_economía_uruguay output.xlsx')
View(df_uy)
library(tidyverse)
library(readxl)
df_uy <- read_excel('data/pict/base_total_economía_uruguay output.xlsx',
sheet = 2
)
glimpse(df_uy)
library(tidyverse)
library(readxl)
paises_sel <- c("ARG","BRA","CHL","VEN","ECU", "BOL",
"PER","COL","URY","PRY","MEX")
epwt <- read_excel('data/pwt/EPWT 7.0 FV.xlsx',
sheet = 'EPWT7.0') %>%
filter(Countrycode %in% paises_sel ) %>%
select(anio = Year, pais = Country, iso3= Countrycode, rnat2017, rnatcur, rppp2017)
library(tidyverse)
library(readxl)
paises_sel <- c("ARG","BRA","CHL","VEN","ECU", "BOL",
"PER","COL","URY","PRY","MEX")
epwt <- read_excel('../../data/pwt/EPWT 7.0 FV.xlsx',
sheet = 'EPWT7.0') %>%
filter(Countrycode %in% paises_sel ) %>%
select(anio = Year, pais = Country, iso3= Countrycode, rnat2017, rnatcur, rppp2017)
df_uy <- read_excel('data/pict/base_total_economía_uruguay output.xlsx',
sheet = 2)
getwd()
